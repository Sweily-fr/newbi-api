# Importe les types communs
# Note: GraphQL n'a pas de directive d'importation native,
# mais la fusion des schémas gère cela pour nous

type Invoice {
  id: ID!
  number: String!
  prefix: String
  purchaseOrderNumber: String
  isDeposit: Boolean!
  invoiceType: String
  situationNumber: Int
  situationReference: String
  client: EmbeddedClient!
  companyInfo: Company!
  items: [Item!]!
  status: InvoiceStatus!
  issueDate: String!
  dueDate: String!
  headerNotes: String
  footerNotes: String
  termsAndConditions: String
  termsAndConditionsLinkTitle: String
  termsAndConditionsLink: String
  discount: Float
  discountType: DiscountType
  retenueGarantie: Float
  escompte: Float
  totalHT: Float!
  totalTTC: Float!
  totalVAT: Float!
  finalTotalHT: Float!
  finalTotalVAT: Float
  finalTotalTTC: Float!
  customFields: [CustomField!]
  discountAmount: Float
  showBankDetails: Boolean
  appearance: Appearance
  shipping: Shipping
  isReverseCharge: Boolean
  clientPositionRight: Boolean
  createdBy: User!
  stripeInvoiceId: String
  linkedTransactionId: ID
  # E-Invoicing SuperPDP
  superPdpInvoiceId: String
  eInvoiceStatus: String
  eInvoiceSentAt: String
  archivedPdfUrl: String
  eInvoiceError: String
  facturXData: FacturXData
  # Routing e-invoicing
  eInvoiceFlowType: String
  eInvoiceFlowReason: String
  createdAt: String!
  updatedAt: String!
}

type FacturXData {
  xmlGenerated: Boolean
  profile: String
  generatedAt: String
}

type InvoicePagination {
  invoices: [Invoice!]!
  totalCount: Int!
  hasNextPage: Boolean!
}

type LinkedInvoiceResult {
  invoice: Invoice!
  quote: Quote!
}

input CreateInvoiceInput {
  isDeposit: Boolean
  invoiceType: String
  situationNumber: Int
  client: ClientInput!
  companyInfo: CompanyInput
  items: [ItemInput!]!
  status: InvoiceStatus = DRAFT
  issueDate: String!
  dueDate: String!
  headerNotes: String
  footerNotes: String
  termsAndConditions: String
  termsAndConditionsLinkTitle: String
  termsAndConditionsLink: String
  discount: Float
  discountType: DiscountType
  retenueGarantie: Float
  escompte: Float
  customFields: [CustomFieldInput!]
  number: String
  prefix: String
  purchaseOrderNumber: String
  situationReference: String
  contractTotal: Float
  showBankDetails: Boolean
  bankDetails: BankDetailsInput
  appearance: AppearanceInput
  shipping: ShippingInput
  isReverseCharge: Boolean
  clientPositionRight: Boolean
}

input UpdateInvoiceInput {
  isDeposit: Boolean
  invoiceType: String
  situationNumber: Int
  client: ClientInput
  companyInfo: CompanyInput
  items: [ItemInput!]
  status: InvoiceStatus
  issueDate: String
  dueDate: String
  headerNotes: String
  footerNotes: String
  termsAndConditions: String
  termsAndConditionsLinkTitle: String
  termsAndConditionsLink: String
  discount: Float
  discountType: DiscountType
  retenueGarantie: Float
  escompte: Float
  customFields: [CustomFieldInput!]
  number: String
  prefix: String
  purchaseOrderNumber: String
  situationReference: String
  contractTotal: Float
  showBankDetails: Boolean
  bankDetails: BankDetailsInput
  appearance: AppearanceInput
  shipping: ShippingInput
  isReverseCharge: Boolean
  clientPositionRight: Boolean
}

extend type Query {
  invoice(id: ID!, workspaceId: ID!): Invoice!
  invoices(
    workspaceId: ID!
    startDate: String
    endDate: String
    status: InvoiceStatus
    search: String
    page: Int
    limit: Int
  ): InvoicePagination!
  invoiceStats(workspaceId: ID!): InvoiceStats!
  nextInvoiceNumber(workspaceId: ID!, prefix: String, isDraft: Boolean): String!
  situationInvoicesByQuoteRef(
    workspaceId: ID!
    purchaseOrderNumber: String!
  ): [Invoice!]!
  situationReferences(workspaceId: ID!, search: String): [SituationReference!]!
}

type SituationReference {
  reference: String!
  count: Int!
  lastInvoiceDate: String
  totalTTC: Float
  contractTotal: Float
}

extend type Mutation {
  createInvoice(workspaceId: ID!, input: CreateInvoiceInput!): Invoice!
  updateInvoice(id: ID!, workspaceId: ID!, input: UpdateInvoiceInput!): Invoice!
  deleteInvoice(id: ID!, workspaceId: ID!): Boolean!
  sendInvoice(id: ID!, workspaceId: ID!, email: String!): Boolean!
  markInvoiceAsPaid(id: ID!, workspaceId: ID!, paymentDate: String!): Invoice!
  changeInvoiceStatus(
    id: ID!
    workspaceId: ID!
    status: InvoiceStatus!
  ): Invoice!
  createLinkedInvoice(
    quoteId: ID!
    workspaceId: ID!
    amount: Float!
    isDeposit: Boolean!
  ): LinkedInvoiceResult!
  deleteLinkedInvoice(id: ID!, workspaceId: ID!): Boolean!
}
