# Types pour le transfert de fichiers volumineux

# Enum pour le statut du transfert de fichiers
enum FileTransferStatus {
  active
  expired
  deleted
}

# Type pour représenter un fichier individuel dans un transfert
type File {
  id: ID!
  fileName: String!
  originalName: String!
  displayName: String
  mimeType: String!
  size: Float!
  filePath: String!
  downloadUrl: String
  r2Key: String
  storageType: String
  fileId: String
}

# Type principal pour le transfert de fichiers
type FileTransfer {
  id: ID!
  userId: ID
  files: [File]
  totalSize: Float
  shareLink: String
  accessKey: String
  expiryDate: Date
  status: FileTransferStatus
  isPaymentRequired: Boolean
  paymentAmount: Float
  paymentCurrency: String
  isPaid: Boolean
  paymentId: String
  paymentDate: Date
  paymentSessionId: String
  paymentSessionUrl: String
  downloadCount: Int
  lastDownloadDate: Date
  recipientEmail: String
  notificationSent: Boolean
  notifyOnDownload: Boolean
  passwordProtected: Boolean
  allowPreview: Boolean
  message: String
  expiryReminderEnabled: Boolean
  expiryReminderSent: Boolean
  createdAt: Date
  updatedAt: Date
  zipDownloadUrl: String
}

# Type pour la réponse paginée des transferts de fichiers
type FileTransferPaginatedResponse {
  items: [FileTransfer!]!
  totalItems: Int!
  currentPage: Int!
  totalPages: Int!
  hasNextPage: Boolean!
}

# Type pour la réponse de création d'un transfert de fichiers
type FileTransferResponse {
  fileTransfer: FileTransfer!
  shareLink: String!
  accessKey: String!
}

# Type pour la réponse de génération d'un lien de paiement
type FileTransferPaymentResponse {
  fileTransfer: FileTransfer!
  paymentSessionUrl: String!
}

# Type pour la réponse d'accès à un transfert de fichiers
type FileTransferAccessResponse {
  success: Boolean!
  message: String
  fileTransfer: FileTransfer
}

# Input pour la création d'un transfert de fichiers
input FileTransferInput {
  expiryDays: Int
  isPaymentRequired: Boolean = false
  requirePayment: Boolean = false # Alias pour isPaymentRequired pour compatibilité avec le frontend
  paymentAmount: Float = 0
  paymentCurrency: String = "EUR"
  currency: String = "EUR" # Alias pour paymentCurrency pour compatibilité avec le frontend
  recipientEmail: String
  message: String
  # Nouvelles options
  notifyOnDownload: Boolean = false
  passwordProtected: Boolean = false
  password: String
  allowPreview: Boolean = true
  expiryReminderEnabled: Boolean = false
}

# Étendre le type Query
extend type Query {
  # Obtenir tous les transferts de fichiers de l'utilisateur connecté avec pagination
  myFileTransfers(
    page: Int = 1
    limit: Int = 10
  ): FileTransferPaginatedResponse!

  # Obtenir un transfert de fichiers par son ID
  fileTransferById(id: ID!): FileTransfer

  # Obtenir un transfert de fichiers par son lien de partage et sa clé d'accès
  getFileTransferByLink(
    shareLink: String!
    accessKey: String!
  ): FileTransferAccessResponse
}

# Input pour un fichier en base64
input Base64FileInput {
  name: String!
  type: String!
  size: Float!
  base64: String!
}

# Étendre le type Mutation
extend type Mutation {
  # Créer un nouveau transfert de fichiers
  createFileTransfer(
    files: [Upload!]!
    input: FileTransferInput
  ): FileTransferResponse!

  # Créer un nouveau transfert de fichiers avec des fichiers en base64
  createFileTransferBase64(
    files: [Base64FileInput!]!
    input: FileTransferInput
  ): FileTransferResponse!

  # Supprimer un transfert de fichiers
  deleteFileTransfer(id: ID!): Boolean!

  # Générer un lien de paiement pour un transfert de fichiers
  generateFileTransferPaymentLink(id: ID!): FileTransferPaymentResponse!
}
