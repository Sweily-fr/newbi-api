# Types pour les documents partagés

type SharedDocument {
  id: ID!
  name: String!
  originalName: String!
  description: String
  fileUrl: String!
  fileKey: String!
  mimeType: String!
  fileSize: Int!
  fileExtension: String
  workspaceId: ID!
  folderId: ID
  folder: SharedFolder
  uploadedBy: ID!
  uploadedByName: String
  status: SharedDocumentStatus!
  isSharedWithAccountant: Boolean!
  tags: [String]
  comments: [DocumentComment]
  createdAt: String!
  updatedAt: String!
  archivedAt: String
  # Corbeille
  trashedAt: String
  originalFolderId: ID
  daysUntilPermanentDeletion: Int
}

type SharedFolder {
  id: ID!
  name: String!
  description: String
  workspaceId: ID!
  parentId: ID
  parent: SharedFolder
  color: String!
  icon: String!
  createdBy: ID!
  isSharedWithAccountant: Boolean!
  order: Int!
  isSystem: Boolean!
  visibility: FolderVisibility
  allowedUserIds: [ID]
  canManageVisibility: Boolean
  documentsCount: Int
  createdAt: String!
  updatedAt: String!
  # Corbeille
  trashedAt: String
  originalParentId: ID
  daysUntilPermanentDeletion: Int
}

type DocumentComment {
  text: String!
  authorId: ID!
  authorName: String
  createdAt: String!
}

enum SharedDocumentStatus {
  pending
  classified
  archived
}

enum FolderVisibility {
  public
  private
}

# Réponses
type SharedDocumentResponse {
  success: Boolean!
  message: String
  document: SharedDocument
}

type SharedDocumentsResponse {
  success: Boolean!
  message: String
  documents: [SharedDocument]
  total: Int
  hasMore: Boolean
}

type SharedFolderResponse {
  success: Boolean!
  message: String
  folder: SharedFolder
}

type SharedFoldersResponse {
  success: Boolean!
  message: String
  folders: [SharedFolder]
}

type DeleteResponse {
  success: Boolean!
  message: String
}

type MoveDocumentsResponse {
  success: Boolean!
  message: String
  movedCount: Int
}

type BulkTagsResponse {
  success: Boolean!
  message: String
  updatedCount: Int
}

# Inputs
input CreateSharedFolderInput {
  name: String!
  description: String
  parentId: ID
  color: String
  icon: String
  isSharedWithAccountant: Boolean
  isSystem: Boolean
  visibility: FolderVisibility
  allowedUserIds: [ID]
}

input UpdateSharedFolderInput {
  name: String
  description: String
  parentId: ID
  color: String
  icon: String
  isSharedWithAccountant: Boolean
  order: Int
  visibility: FolderVisibility
  allowedUserIds: [ID]
}

input UpdateSharedDocumentInput {
  name: String
  description: String
  folderId: ID
  status: SharedDocumentStatus
  isSharedWithAccountant: Boolean
  tags: [String]
}

input AddDocumentCommentInput {
  documentId: ID!
  text: String!
}

input SharedDocumentsFilterInput {
  folderId: ID
  status: SharedDocumentStatus
  search: String
  tags: [String]
  # Filtres avancés
  fileType: String # "image", "video", "pdf", "document", "spreadsheet", "other"
  dateFrom: String # ISO date string
  dateTo: String # ISO date string
  minSize: Int # en bytes
  maxSize: Int # en bytes
}

# Queries
extend type Query {
  # Documents
  sharedDocuments(
    workspaceId: ID!
    filter: SharedDocumentsFilterInput
    limit: Int
    offset: Int
    sortBy: String
    sortOrder: String
  ): SharedDocumentsResponse!

  sharedDocument(id: ID!, workspaceId: ID!): SharedDocumentResponse!

  # Dossiers
  sharedFolders(workspaceId: ID!): SharedFoldersResponse!
  sharedFolder(id: ID!, workspaceId: ID!): SharedFolderResponse!

  # Stats
  sharedDocumentsStats(workspaceId: ID!): SharedDocumentsStatsResponse!

  # Corbeille
  trashItems(workspaceId: ID!): TrashItemsResponse!
}

type SharedDocumentsStatsResponse {
  success: Boolean!
  totalDocuments: Int!
  pendingDocuments: Int!
  classifiedDocuments: Int!
  archivedDocuments: Int!
  totalFolders: Int!
  totalSize: Float!
  # Stats corbeille
  trashedDocuments: Int!
  trashedFolders: Int!
  trashedSize: Float!
}

# Réponse pour les éléments de la corbeille
type TrashItemsResponse {
  success: Boolean!
  message: String
  documents: [SharedDocument]
  folders: [SharedFolder]
  totalDocuments: Int
  totalFolders: Int
  totalSize: Float
}

type RestoreResponse {
  success: Boolean!
  message: String
  restoredDocuments: Int
  restoredFolders: Int
}

# Mutations
extend type Mutation {
  # Documents
  uploadSharedDocument(
    workspaceId: ID!
    file: Upload!
    folderId: ID
    name: String
    description: String
    tags: [String]
  ): SharedDocumentResponse!

  updateSharedDocument(
    id: ID!
    workspaceId: ID!
    input: UpdateSharedDocumentInput!
  ): SharedDocumentResponse!

  deleteSharedDocument(id: ID!, workspaceId: ID!): DeleteResponse!

  deleteSharedDocuments(ids: [ID!]!, workspaceId: ID!): DeleteResponse!

  moveSharedDocuments(
    ids: [ID!]!
    workspaceId: ID!
    targetFolderId: ID
  ): MoveDocumentsResponse!

  addDocumentComment(
    workspaceId: ID!
    input: AddDocumentCommentInput!
  ): SharedDocumentResponse!

  # Dossiers
  createSharedFolder(
    workspaceId: ID!
    input: CreateSharedFolderInput!
  ): SharedFolderResponse!

  updateSharedFolder(
    id: ID!
    workspaceId: ID!
    input: UpdateSharedFolderInput!
  ): SharedFolderResponse!

  deleteSharedFolder(id: ID!, workspaceId: ID!): DeleteResponse!

  updateFolderVisibility(
    id: ID!
    workspaceId: ID!
    visibility: FolderVisibility!
    allowedUserIds: [ID]
  ): SharedFolderResponse!

  # Tags en masse
  bulkUpdateTags(
    ids: [ID!]!
    workspaceId: ID!
    addTags: [String]
    removeTags: [String]
  ): BulkTagsResponse!

  # Corbeille
  restoreFromTrash(
    workspaceId: ID!
    documentIds: [ID]
    folderIds: [ID]
  ): RestoreResponse!

  emptyTrash(workspaceId: ID!): DeleteResponse!

  permanentlyDeleteDocuments(ids: [ID!]!, workspaceId: ID!): DeleteResponse!
  permanentlyDeleteFolders(ids: [ID!]!, workspaceId: ID!): DeleteResponse!
}
