# schemas/kanban.graphql
type Board {
  id: ID!
  title: String!
  description: String
  userId: ID!
  columns: [Column!]!
  tasks: [Task!]!
  members: [OrganizationMember!]!
  totalBillableAmount: Float
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Column {
  id: ID!
  title: String!
  color: String!
  boardId: ID!
  order: Int!
  tasks: [Task!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}


type TimeEntry {
  id: ID!
  startTime: DateTime!
  endTime: DateTime
  duration: Int!
}

type TimerStartedBy {
  userId: String
  userName: String
  userImage: String
}

type TimeTracking {
  totalSeconds: Int!
  isRunning: Boolean!
  currentStartTime: DateTime
  startedBy: TimerStartedBy
  entries: [TimeEntry!]!
  hourlyRate: Float
  roundingOption: String
}

type Comment {
  id: ID!
  userId: String!
  userName: String
  userImage: String
  content: String!
  images: [TaskImage!]
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Activity {
  id: ID!
  userId: String!
  userName: String
  userImage: String
  type: String!
  field: String
  oldValue: JSON
  newValue: JSON
  description: String
  createdAt: DateTime!
}

type AssignedMemberInfo {
  id: ID!
  userId: ID!
  name: String
  email: String
  image: String
}

type Task {
  id: ID!
  title: String!
  description: String
  status: String!
  priority: String
  tags: [Tag!]
  startDate: DateTime
  dueDate: DateTime
  boardId: ID!
  columnId: String!
  position: Int
  checklist: [ChecklistItem!]
  assignedMembers: [String!]
  assignedMembersInfo: [AssignedMemberInfo!]
  images: [TaskImage!]
  comments: [Comment!]
  activity: [Activity!]
  timeTracking: TimeTracking
  userId: ID
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Tag {
  name: String!
  className: String!
  bg: String!
  text: String!
  border: String!
}

type ChecklistItem {
  id: ID
  text: String!
  completed: Boolean!
}

type TaskImage {
  id: ID!
  key: String!
  url: String!
  fileName: String!
  fileSize: Int
  contentType: String
  uploadedBy: String!
  uploadedAt: DateTime!
}

input CreateBoardInput {
  title: String!
  description: String
}

input UpdateBoardInput {
  id: ID!
  title: String
  description: String
}

input CreateColumnInput {
  title: String!
  color: String!
  boardId: ID!
  order: Int!
}

input UpdateColumnInput {
  id: ID!
  title: String
  color: String
  order: Int
}


input TimeTrackingInput {
  hourlyRate: Float
  roundingOption: String
}

input CreateTaskInput {
  title: String!
  description: String
  status: String
  priority: String
  tags: [TagInput!]
  startDate: DateTime
  dueDate: DateTime
  boardId: ID!
  columnId: String!
  position: Int
  checklist: [ChecklistItemInput!]
  assignedMembers: [String!]
  timeTracking: TimeTrackingInput
}

input UpdateTaskInput {
  id: ID!
  title: String
  description: String
  status: String
  priority: String
  tags: [TagInput!]
  startDate: DateTime
  dueDate: DateTime
  columnId: String
  position: Int
  checklist: [ChecklistItemInput!]
  assignedMembers: [String!]
  timeTracking: TimeTrackingInput
}

input TagInput {
  name: String!
  className: String!
  bg: String!
  text: String!
  border: String!
}

input ChecklistItemInput {
  id: ID
  text: String!
  completed: Boolean
}

input CommentInput {
  content: String
}

input TaskImageInput {
  key: String!
  url: String!
  fileName: String!
  fileSize: Int
  contentType: String
}

type TaskImageUploadResult {
  success: Boolean!
  image: TaskImage
  message: String
}

type OrganizationMember {
  id: String!
  userId: String!
  name: String!
  email: String!
  image: String
  role: String
}

type UserInfo {
  id: String!
  name: String!
  email: String!
  image: String
}

type Query {
  boards(workspaceId: ID): [Board!]!
  board(id: ID!, workspaceId: ID): Board
  columns(boardId: ID!, workspaceId: ID): [Column!]!
  column(id: ID!, workspaceId: ID): Column
  tasks(boardId: ID!, columnId: ID, workspaceId: ID): [Task!]!
  task(id: ID!, workspaceId: ID): Task
  activeTimers(workspaceId: ID): [Task!]!
  organizationMembers(workspaceId: ID!): [OrganizationMember!]!
  usersInfo(userIds: [String!]!): [UserInfo!]!
}

type Mutation {
  createBoard(input: CreateBoardInput!, workspaceId: ID): Board!
  updateBoard(input: UpdateBoardInput!, workspaceId: ID): Board!
  deleteBoard(id: ID!, workspaceId: ID): Boolean!
  
  createColumn(input: CreateColumnInput!, workspaceId: ID): Column!
  updateColumn(input: UpdateColumnInput!, workspaceId: ID): Column!
  deleteColumn(id: ID!, workspaceId: ID): Boolean!
  reorderColumns(columns: [ID!]!, workspaceId: ID): Boolean!
  
  createTask(input: CreateTaskInput!, workspaceId: ID): Task!
  updateTask(input: UpdateTaskInput!, workspaceId: ID): Task!
  deleteTask(id: ID!, workspaceId: ID): Boolean!
  moveTask(id: ID!, columnId: String!, position: Int!, workspaceId: ID): Task!
  
  addComment(taskId: ID!, input: CommentInput!, workspaceId: ID): Task!
  updateComment(taskId: ID!, commentId: ID!, content: String!, workspaceId: ID): Task!
  deleteComment(taskId: ID!, commentId: ID!, workspaceId: ID): Task!
  
  startTimer(taskId: ID!, workspaceId: ID): Task!
  stopTimer(taskId: ID!, workspaceId: ID): Task!
  resetTimer(taskId: ID!, workspaceId: ID): Task!
  updateTimerSettings(taskId: ID!, hourlyRate: Float, roundingOption: String, workspaceId: ID): Task!
  
  # Mutations pour les images de t√¢ches
  uploadTaskImage(taskId: ID!, file: Upload!, imageType: String, workspaceId: ID): TaskImageUploadResult!
  deleteTaskImage(taskId: ID!, imageId: ID!, workspaceId: ID): Task!
  addTaskImageFromUrl(taskId: ID!, input: TaskImageInput!, workspaceId: ID): Task!
  
  # Mutations pour les images de commentaires
  uploadCommentImage(taskId: ID!, commentId: ID!, file: Upload!, workspaceId: ID): TaskImageUploadResult!
  deleteCommentImage(taskId: ID!, commentId: ID!, imageId: ID!, workspaceId: ID): Task!
}

type Subscription {
  boardUpdated(workspaceId: ID!): BoardUpdatePayload!
  taskUpdated(boardId: ID!, workspaceId: ID!): TaskUpdatePayload
  columnUpdated(boardId: ID!, workspaceId: ID!): ColumnUpdatePayload!
}

type BoardUpdatePayload {
  type: String!
  board: Board
  boardId: ID
  workspaceId: ID!
}

type TaskUpdatePayload {
  type: String!
  task: Task
  taskId: ID
  boardId: ID!
  workspaceId: ID!
  visitor: VisitorInfo
}

type VisitorInfo {
  id: String
  email: String
  firstName: String
  lastName: String
  name: String
  image: String
}

type ColumnUpdatePayload {
  type: String!
  column: Column
  columns: [ID!]
  columnId: ID
  boardId: ID!
  workspaceId: ID!
}