type PartnerStats {
  totalEarnings: Float!
  availableBalance: Float!
  totalRevenue: Float!
  activeReferrals: Int!
  totalReferrals: Int!
  commissionRate: Float!
  currentTier: String!
  nextTier: String
  progressToNextTier: Float!
  earningsHistory: [MonthlyEarnings!]!
  revenueHistory: [MonthlyRevenue!]!
  withdrawals: [Withdrawal!]!
}

type MonthlyEarnings {
  month: String!
  year: Int!
  earnings: Float!
}

type MonthlyRevenue {
  month: String!
  year: Int!
  revenue: Float!
}

type Withdrawal {
  id: ID!
  amount: Float!
  status: String!
  requestedAt: String!
  processedAt: String
  method: String
  bankDetails: BankDetailsInfo
}

type WithdrawalAdmin {
  id: ID!
  amount: Float!
  status: String!
  requestedAt: String!
  processedAt: String
  method: String
  bankDetails: BankDetailsInfo
  partner: PartnerInfo!
}

type PartnerInfo {
  id: ID!
  name: String!
  email: String!
  totalEarnings: Float!
  availableBalance: Float!
}

type BankDetailsInfo {
  iban: String
  bic: String
  accountHolder: String
}

type CommissionTier {
  name: String!
  percentage: Float!
  minRevenue: Float!
  maxRevenue: Float
}

type WithdrawalResponse {
  success: Boolean!
  message: String!
  withdrawal: Withdrawal
}

type ReferralDetail {
  id: ID!
  name: String
  email: String!
  company: String
  subscriptionType: String
  subscriptionPrice: Float
  status: String!
  registrationDate: String!
  totalRevenue: Float!
  commission: Float!
}

type OrganizationBankDetails {
  bankName: String
  bankIban: String
  bankBic: String
}

type Query {
  # Récupérer les statistiques du partenaire connecté
  getPartnerStats: PartnerStats!
  
  # Récupérer les paliers de commission
  getCommissionTiers: [CommissionTier!]!
  
  # Récupérer l'historique des retraits
  getWithdrawals: [Withdrawal!]!
  
  # Récupérer la liste détaillée des filleuls avec leurs commissions
  getPartnerReferrals: [ReferralDetail!]!
  
  # Récupérer les coordonnées bancaires de l'organisation
  getOrganizationBankDetails(organizationId: ID!): OrganizationBankDetails
  
  # ADMIN: Récupérer tous les retraits en attente (admin uniquement)
  getAllWithdrawals(status: String): [WithdrawalAdmin!]!
}

type Mutation {
  # Demander un retrait de gains
  requestWithdrawal(
    amount: Float!
    method: String!
  ): WithdrawalResponse!
  
  # Mettre à jour les coordonnées bancaires de l'organisation
  updateOrganizationBankDetails(
    organizationId: ID!
    bankName: String!
    bankIban: String!
    bankBic: String!
  ): WithdrawalResponse!
  
  # ADMIN: Approuver un retrait (admin uniquement)
  approveWithdrawal(withdrawalId: ID!): WithdrawalResponse!
  
  # ADMIN: Rejeter un retrait (admin uniquement)
  rejectWithdrawal(withdrawalId: ID!, reason: String): WithdrawalResponse!
}
