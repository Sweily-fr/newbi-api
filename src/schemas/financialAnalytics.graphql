type FinancialAnalyticsKPI {
  totalRevenueHT: Float!
  totalRevenueTTC: Float!
  totalExpenses: Float!
  netResult: Float!
  invoiceCount: Int!
  expenseCount: Int!
  averageInvoiceHT: Float!
  clientCount: Int!
  quoteConversionRate: Float!
  # New fields
  totalExpensesHT: Float!
  totalExpensesTTC: Float!
  grossMargin: Float!
  grossMarginRate: Float!
  chargeRate: Float!
  creditNoteCount: Int!
  creditNoteTotalHT: Float!
  netRevenueHT: Float!
  outstandingReceivables: Float!
  overdueAmount: Float!
  overdueCount: Int!
  dso: Float!
  collectionRate: Float!
  activeClientCount: Int!
  newClientCount: Int!
  retainedClientCount: Int!
  topClientConcentration: Float!
  quoteCount: Int!
  quoteConvertedCount: Int!
}

type FinancialAnalyticsPreviousPeriod {
  totalRevenueHT: Float!
  totalExpensesHT: Float!
  grossMargin: Float!
  grossMarginRate: Float!
  invoiceCount: Int!
  averageInvoiceHT: Float!
  collectionRate: Float!
  dso: Float!
  activeClientCount: Int!
  newClientCount: Int!
  quoteConversionRate: Float!
  netRevenueHT: Float!
  creditNoteTotalHT: Float!
  overdueAmount: Float!
  overdueCount: Int!
  outstandingReceivables: Float!
  topClientConcentration: Float!
  chargeRate: Float!
}

type RevenueByClient {
  clientId: ID
  clientName: String!
  clientType: String
  totalHT: Float!
  totalTTC: Float!
  totalVAT: Float!
  invoiceCount: Int!
  averageInvoiceHT: Float!
  totalTimeSeconds: Int
  totalBillableAmount: Float
  totalHours: Float
}

type RevenueByProduct {
  description: String!
  totalHT: Float!
  totalQuantity: Float!
  invoiceCount: Int!
  averageUnitPrice: Float!
}

type MonthlyRevenue {
  month: String!
  revenueHT: Float!
  revenueTTC: Float!
  revenueVAT: Float!
  expenseAmount: Float!
  invoiceCount: Int!
  expenseCount: Int!
  netResult: Float!
  # New fields
  expenseAmountHT: Float!
  expenseVAT: Float!
  grossMargin: Float!
  grossMarginRate: Float!
  creditNoteHT: Float!
  netRevenueHT: Float!
}

type PaymentMethodStat {
  method: String!
  count: Int!
  totalTTC: Float!
}

type InvoiceStatusBreakdown {
  status: String!
  count: Int!
  totalTTC: Float!
}

type TopClient {
  clientId: ID
  clientName: String!
  totalTTC: Float!
  invoiceCount: Int!
  percentage: Float!
}

type ExpenseByCategoryStat {
  category: String!
  amount: Float!
  count: Int!
}

type RevenueByClientMonthly {
  clientId: ID
  clientName: String!
  month: String!
  totalHT: Float!
  totalTTC: Float!
  totalVAT: Float!
  invoiceCount: Int!
}

type ExpenseByCategoryMonthly {
  category: String!
  month: String!
  amount: Float!
  count: Int!
}

type OverdueInvoice {
  invoiceId: ID!
  invoiceNumber: String!
  clientName: String!
  totalTTC: Float!
  dueDate: String!
  daysOverdue: Int!
}

type AgingBucket {
  label: String!
  min: Int!
  max: Int!
  count: Int!
  totalTTC: Float!
}

type MonthlyCollection {
  month: String!
  invoicedTTC: Float!
  collectedTTC: Float!
  invoicedCount: Int!
  collectedCount: Int!
}

type CollectionData {
  overdueInvoices: [OverdueInvoice!]!
  agingBuckets: [AgingBucket!]!
  monthlyCollection: [MonthlyCollection!]!
}

type AnalyticsAlert {
  type: String!
  severity: String!
  message: String!
  value: Float
  threshold: Float
}

type FinancialAnalyticsData {
  kpi: FinancialAnalyticsKPI!
  previousPeriod: FinancialAnalyticsPreviousPeriod
  revenueByClient: [RevenueByClient!]!
  revenueByProduct: [RevenueByProduct!]!
  monthlyRevenue: [MonthlyRevenue!]!
  paymentMethodStats: [PaymentMethodStat!]!
  statusBreakdown: [InvoiceStatusBreakdown!]!
  topClients: [TopClient!]!
  expenseByCategory: [ExpenseByCategoryStat!]!
  revenueByClientMonthly: [RevenueByClientMonthly!]!
  expenseByCategoryMonthly: [ExpenseByCategoryMonthly!]!
  collection: CollectionData!
  alerts: [AnalyticsAlert!]!
}

type Query {
  financialAnalytics(
    workspaceId: ID
    startDate: String!
    endDate: String!
    clientId: ID
    clientIds: [ID]
    status: [String]
  ): FinancialAnalyticsData!
}
